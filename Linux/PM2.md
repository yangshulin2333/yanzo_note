好的，既然你已经进入了 `qq-farm-bot-ui` 目录，请按照以下步骤依次输入命令。

这些命令将帮助你安装 **PM2** 管理器，并让你的机器人程序在后台永久运行。

### 第一步：安装 PM2

首先安装这个进程管理工具，它能保证你关掉终端后程序不挂掉：

Bash

```
sudo npm install -g pm2
```

### 第二步：启动后台运行

使用 PM2 启动项目，并传入你之前的环境变量和名字。请直接复制下面这一整行：

Bash

```
pm2 start client.js --name "qq-farm" --env ADMIN_PASSWORD='yanzo'
```

### 第三步：设置开机自启

为了防止服务器重启后项目不启动，执行以下两步：

1. **保存当前列表**：
    
    Bash
    
    ```
    pm2 save
    ```
    
2. **生成自启脚本**：
    
    Bash
    
    ```
    pm2 startup
    ```
    
    _注意：执行完 `pm2 startup` 后，屏幕上会跳出一行以 `sudo env ...` 开头的长命令，你需要**手动复制并运行那一行命令**_。
    

---

### 常用管理“小抄”

现在项目已经在后台了，你可以通过以下命令随时查看它的情况：

- **看机器人还在不在跑**：
    
    Bash
    
    ```
    pm2 list
    ```
    
- **看实时日志（查看报错或登录信息）**：
    
    Bash
    
    ```
    pm2 logs qq-farm
    ```
    
- **重启机器人（改了配置后常用）**：
    
    Bash
    
    ```
    pm2 restart qq-farm
    ```
    
- **停止机器人**：
    
    Bash
    
    ```
    pm2 stop qq-farm
    ```
    

---

### ⚠️ 特别提醒

如果你在 `pm2 logs` 里看到还是有之前的 `WS 400` 错误，说明后台虽然在运行，但**账号连接有问题**。

请确保你已经在腾讯云后台开放了 **3000** 端口，然后在浏览器访问 `http://101.42.7.58:3000` 重新登录账号。

**操作过程中有哪一步跳出错误了吗？**




PM2 是 Node.js 社区最流行的**进程管理工具**。简单来说，它就像是给你程序雇佣的一个“全职保镖”加“专业管家”，负责让你的代码 24 小时保持运行，挂了自动重启。

以下是关于 PM2 的核心知识点总结：

---

### 1. 核心功能

- **后台运行**：普通启动命令在关闭 SSH 窗口后会停止，PM2 可以让程序在后台持续运行。
    
- **自动重启**：如果程序崩溃（Runtime Error），PM2 会瞬间检测并尝试自动重启项目。
    
- **负载均衡 (Cluster Mode)**：Node.js 是单线程的，PM2 可以根据你 CPU 的核心数开启多个进程实例，大幅提升处理能力。
    
- **日志管理**：它会自动收集并记录程序的 `console.log` 和错误日志，避免日志堆死服务器磁盘。
    

---

### 2. 常用命令速查表

|**功能**|**命令**|
|---|---|
|**启动项目**|`pm2 start app.js --name "my-project"`|
|**查看所有进程**|`pm2 list` (或者 `pm2 status`)|
|**查看实时日志**|`pm2 logs [ID/Name]`|
|**重启项目**|`pm2 restart [ID/Name]`|
|**停止项目**|`pm2 stop [ID/Name]`|
|**删除项目记录**|`pm2 delete [ID/Name]`|
|**查看资源占用**|`pm2 monit` (仪表盘模式)|

---

### 3. 进阶：如何开启多核模式？

如果你想让你的 QQ 农场机器人火力全开（虽然这类小项目通常不需要），可以使用 `-i` 参数：

Bash

```
# 自动根据 CPU 核心数启动最大数量的进程
pm2 start client.js -i max 
```

---

### 4. 为什么你会看到 `WS 400` 错误？

在 PM2 环境下，如果执行 `pm2 logs` 看到大量重复的报错，这通常不是 PM2 的锅，而是**程序逻辑问题**：

- **死循环重启**：如果程序代码一启动就报错，PM2 会疯狂尝试重启。你可以设置 `--max-restarts [次数]` 来限制这种行为。
    
- **网络断连**：由于 PM2 是在后台静默运行，它无法像前台那样弹出二维码让你扫。你必须确保 **3000 端口管理面板** 畅通，通过网页端完成登录鉴权。
    

---

### 5. 配置文件启动 (Ecosystem File)

当你的参数变多（比如环境变量、日志路径）时，命令行会变得很长。PM2 支持使用 `ecosystem.config.js` 文件来管理：

JavaScript

```
module.exports = {
  apps : [{
    name: "qq-farm",
    script: "./client.js",
    env: {
      ADMIN_PASSWORD: "yanzo",
      NODE_ENV: "production"
    },
    watch: true // 文件变动自动重启，开发时很好用
  }]
}
```

配置好后，只需输入 `pm2 start` 即可。

**你想尝试把现在的启动命令写成一个配置文件，方便以后管理吗？**


如果你发现 `ADMIN_PASSWORD` 设置错了，或者想要通过配置文件来管理项目，可以按照以下步骤操作：

### 1. 创建配置文件

在你的项目目录 `qq-farm-bot-ui` 下，创建一个名为 `ecosystem.config.js` 的文件：

Bash

```
nano ecosystem.config.js
```

### 2. 写入配置内容

在打开的编辑器中，粘贴以下内容（**请将 `你的正确密码` 替换掉**）：

JavaScript

```
module.exports = {
  apps : [{
    name: "qq-farm",         // 项目名称
    script: "./client.js",   // 启动脚本
    env: {
      ADMIN_PASSWORD: "你的正确密码", // 在这里修改你的正确密码
      NODE_ENV: "production"
    },
    // 以下是进阶配置（可选）
    error_file: "./logs/err.log",   // 错误日志路径
    out_file: "./logs/out.log",     // 普通日志路径
    log_date_format: "YYYY-MM-DD HH:mm:ss" 
  }]
}
```

_按 `Ctrl + O` 然后回车保存，再按 `Ctrl + X` 退出。_

### 3. 使用配置文件重新启动

由于你之前已经用命令行启动过一个叫 `qq-farm` 的进程，我们需要**先删除旧进程，再用新配置启动**：

Bash

```
# 1. 删除旧的进程记录
pm2 delete qq-farm

# 2. 使用配置文件启动
pm2 start ecosystem.config.js

# 3. 保存配置，确保开机自启也更新
pm2 save
```

### 4. 验证修改是否生效

输入以下命令查看日志，确认程序是否带着正确的密码跑起来了：

Bash

```
pm2 logs qq-farm
```

---

### 💡 为什么推荐用配置文件？

1. **修改方便**：以后改密码只需改这个文件，不需要记长串的命令。
    
2. **日志清晰**：可以像上面那样指定日志存在 `./logs/` 文件夹里，方便以后排查 `WS 400` 这种错误。
    
3. **多项目管理**：如果你以后想同时跑两个机器人，只需在 `apps` 数组里再加一项即可。
    

**修改过程中如果遇到权限问题（比如无法创建文件），请在命令前加 `sudo`。**