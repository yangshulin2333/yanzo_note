[Github农场地址](https://github.com/Penty-d/qq-farm-bot-ui#)


# 🚀 Ubuntu 22.04 部署 QQ 农场项目笔记

## 一、 环境准备

在 Ubuntu 22.04 上，首先需要安装 Node.js 环境。

1. **安装 Node.js (v18 LTS)**
    
    Bash
    
    ```
    sudo apt update
	sudo apt install -y curl
	curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
	sudo apt install -y nodejs
    ```
    
2. **验证版本**
    
    Bash
    
    ```
    node -v
    npm -v
    ```
    

---

## 二、 获取项目代码

由于网络环境问题，推荐使用**镜像加速站**进行克隆，避免 HTTPS 超时。

Bash

```
git clone https://ghfast.top/https://github.com/Penty-d/qq-farm-bot-ui.git
cd qq-farm-bot-ui
npm install  # 安装项目依赖
```

---

## 三、 使用 PM2 实现后台永久运行

普通启动（`node client.js`）会在关闭窗口后停止，使用 PM2 可以解决此问题。

### 1. 安装 PM2

Bash

```
sudo npm install -g pm2
```

### 2. 通过配置文件管理（推荐）

创建 `ecosystem.config.js` 文件，统一管理环境变量和密码。

- **创建文件**：`nano ecosystem.config.js`
    
- **配置内容**：
    
    JavaScript
    
    ```
    module.exports = {
      apps : [{
        name: "qq-farm",
        script: "./client.js",
        env: {
          ADMIN_PASSWORD: "你的正确密码"
        }
      }]
    }
    ```
    

### 3. 启动与自启设置

Bash

```
pm2 start ecosystem.config.js  # 启动
pm2 save                        # 保存当前进程列表
pm2 startup                     # 设置开机自启（需执行命令返回的长代码）
```

---

## 四、 常用维护命令

|**命令**|**作用**|
|---|---|
|**`pm2 list`**|查看当前运行的所有后台项目状态|
|**`pm2 logs qq-farm`**|**查看实时日志**（排查登录、报错的关键）|
|**`pm2 restart qq-farm`**|修改配置或密码后，重启项目生效|
|**`pm2 stop qq-farm`**|停止运行项目|

---

## 五、 关键排错与网络设置

1. **管理面板无法访问**：
    
    - **腾讯云控制台**：检查防火墙/安全组，必须**开放 TCP 3000 端口**。
        
    - **系统内部**：执行 `sudo ufw allow 3000` 放行。
        
2. **WS 400 错误**：
    
    - 代表 WebSocket 连接被拒绝。这通常是账号需要重新扫码登录，请访问 `http://你的IP:3000` 登录。
        

---

> **💡 建议**：你可以把这段内容保存到你的 Notion、Obsidian 或者简单的 `.txt` 文件里。
> 
> **还需要我帮你把这份笔记保存成一个可以在服务器上直接查看的文件吗？**





## 代码讲解
这个文件是 **PM2 的生态系统配置文件** (Ecosystem File)。它的作用是把分散在命令行里的启动参数，统一封装成一个结构化的脚本，方便管理和自动化部署。

下面是这段代码每一部分的详细解析：

---

### 1. `module.exports = { ... }`

- **含义**：这是 Node.js 的标准模块导出语法。
    
- **作用**：它告诉 PM2，“这就是我要执行的全部配置内容”。PM2 读取这个文件后，会将其解析为一个配置对象。
    

### 2. `apps : [{ ... }]`

- **含义**：这是一个数组，代表你可以同时运行多个应用。
    
- **作用**：如果你以后想在同一台服务器上跑“农场机器人”和“牧场机器人”，你只需要在数组里增加第二个对象 `{ ... }`，PM2 就能一次性全部启动。
    

### 3. `name: "qq-farm"`

- **含义**：应用的别名。
    
- **作用**：
    
    - **方便识别**：在执行 `pm2 list` 时，显示的名称就是这个。
        
    - **简化操作**：以后你可以直接运行 `pm2 stop qq-farm`，而不需要去记这个进程的 ID（比如 0 或 1）。
        

### 4. `script: "./client.js"`

- **含义**：程序的入口文件。
    
- **作用**：相当于告诉 PM2 执行 `node ./client.js` 这个动作。它定义了哪个脚本是项目的“心脏”。
    

### 5. `env: { ... }`

- **含义**：**环境变量** (Environment Variables)。
    
- **核心作用**：这是最关键的部分。
    
    - **安全隔离**：你可以把敏感信息（如 `ADMIN_PASSWORD`）写在这里，而不是直接硬编码在 `.js` 源码里。
        
    - **项目读取**：程序运行后，`client.js` 内部可以通过 `process.env.ADMIN_PASSWORD` 自动读取到你在这里设置的密码。
        
    - **环境切换**：你可以配置 `env_production` 或 `env_dev`，实现在“正式环境”和“测试环境”之间一键切换，而不需要修改代码逻辑。
        

---

### 💡 为什么推荐这种写法，而不是直接敲命令？

1. **防丢记忆**：如果你一个月没动服务器，你肯定忘了当初启动时设置的密码是什么。有了这个文件，配置一目了然。
    
2. **版本控制**：你可以把这个文件也上传到 GitHub（注意隐藏密码），下次换服务器部署时，直接 `pm2 start` 就搞定了。
    
3. **精细化管理**：
    
    - 你可以轻松添加 `watch: true`（文件一改动，机器人自动重启）。
        
    - 可以指定日志路径：`error_file: "./logs/err.log"`，防止日志乱跑。
        

**现在你的配置文件已经生效了吗？如果想改密码，只需要编辑这个文件再执行 `pm2 restart qq-farm` 即可！**