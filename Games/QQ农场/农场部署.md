太棒了！折腾了这一通，你应该对 Linux 服务器部署有了更深的理解。为了方便你以后查阅，我把这次从**环境安装**到**后台运行**的整个过程总结成了 Markdown 笔记。

---

# 🚀 Ubuntu 22.04 部署 QQ 农场项目笔记

## 一、 环境准备

在 Ubuntu 22.04 上，首先需要安装 Node.js 环境。

1. **安装 Node.js (v20 LTS)**
    
    Bash
    
    ```
    curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
    sudo apt-get install -y nodejs
    ```
    
2. **验证版本**
    
    Bash
    
    ```
    node -v
    npm -v
    ```
    

---

## 二、 获取项目代码

由于网络环境问题，推荐使用**镜像加速站**进行克隆，避免 HTTPS 超时。

Bash

```
git clone https://ghfast.top/https://github.com/Penty-d/qq-farm-bot-ui.git
cd qq-farm-bot-ui
npm install  # 安装项目依赖
```

---

## 三、 使用 PM2 实现后台永久运行

普通启动（`node client.js`）会在关闭窗口后停止，使用 PM2 可以解决此问题。

### 1. 安装 PM2

Bash

```
sudo npm install -g pm2
```

### 2. 通过配置文件管理（推荐）

创建 `ecosystem.config.js` 文件，统一管理环境变量和密码。

- **创建文件**：`nano ecosystem.config.js`
    
- **配置内容**：
    
    JavaScript
    
    ```
    module.exports = {
      apps : [{
        name: "qq-farm",
        script: "./client.js",
        env: {
          ADMIN_PASSWORD: "你的正确密码"
        }
      }]
    }
    ```
    

### 3. 启动与自启设置

Bash

```
pm2 start ecosystem.config.js  # 启动
pm2 save                        # 保存当前进程列表
pm2 startup                     # 设置开机自启（需执行命令返回的长代码）
```

---

## 四、 常用维护命令

|**命令**|**作用**|
|---|---|
|**`pm2 list`**|查看当前运行的所有后台项目状态|
|**`pm2 logs qq-farm`**|**查看实时日志**（排查登录、报错的关键）|
|**`pm2 restart qq-farm`**|修改配置或密码后，重启项目生效|
|**`pm2 stop qq-farm`**|停止运行项目|

---

## 五、 关键排错与网络设置

1. **管理面板无法访问**：
    
    - **腾讯云控制台**：检查防火墙/安全组，必须**开放 TCP 3000 端口**。
        
    - **系统内部**：执行 `sudo ufw allow 3000` 放行。
        
2. **WS 400 错误**：
    
    - 代表 WebSocket 连接被拒绝。这通常是账号需要重新扫码登录，请访问 `http://你的IP:3000` 登录。
        

---

> **💡 建议**：你可以把这段内容保存到你的 Notion、Obsidian 或者简单的 `.txt` 文件里。
> 
> **还需要我帮你把这份笔记保存成一个可以在服务器上直接查看的文件吗？**