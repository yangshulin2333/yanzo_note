---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'



# Goose Goose Duck

```mermaid
graph TD
    %% 定义样式 - 适配 Obsidian 深色/浅色模式的通用配色
    classDef input fill:#E1BEE7,stroke:#4A148C,stroke-width:2px,color:#000;
    classDef process fill:#BBDEFB,stroke:#0D47A1,stroke-width:2px,color:#000;
    classDef logic fill:#FFF9C4,stroke:#F57F17,stroke-width:2px,color:#000;
    classDef output fill:#C8E6C9,stroke:#1B5E20,stroke-width:2px,color:#000;
    classDef storage fill:#F5F5F5,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5,color:#000;

    %% 输入层
    subgraph Inputs [数据采集层]
        Screen[🖥️ 屏幕画面流<br/>mss 截图]:::input
        Audio[🎤 系统音频流<br/>Virtual Cable]:::input
    end

    %% 处理层
    subgraph Processing [实时处理层]
        %% 视觉分支
        direction TB
        StateCheck{游戏状态检测<br/>OpenCV 模板匹配}:::process
        
        Screen --> StateCheck
        
        subgraph MeetingPhase [会议阶段处理]
            OCR[OCR 文字识别<br/>提取玩家 ID]:::process
            VisualVAD[视觉 VAD 检测<br/>OpenCV 检测绿色光圈]:::process
        end
        
        StateCheck -- 游戏中 --> MapLoc[地图定位记录]:::storage
        StateCheck -- 会议中 --> MeetingPhase
        
        %% 音频分支
        ASR[语音转文字 ASR<br/>Faster-Whisper]:::process
        Audio --> ASR
    end

    %% 数据融合层
    subgraph Alignment [多模态对齐]
        Merger(数据融合器):::process
        VisualVAD -- "时间戳+谁在说话" --> Merger
        ASR -- "时间戳+文本" --> Merger
        OCR -- "ID映射表" --> Merger
        
        Transcript[📝 结构化对话日志]:::storage
        Merger --> Transcript
    end

    %% 逻辑大脑层
    subgraph Brain [AI 决策大脑]
        Context[上下文构建<br/>Prompt Engineering]:::logic
        LLM[大模型推理<br/>DeepSeek / GPT-4o]:::logic
        
        MapLoc -.-> Context
        Transcript --> Context
        Context --> LLM
    end

    %% 输出层
    subgraph UI [用户交互]
        Overlay[💻 屏幕 Overlay 提示]:::output
    end

    LLM -- "1. 谎言判定<br/>2. 投票建议" --> Overlay
```


# GooseMind

理顺了！为了让你更直观地看到这个“鹅鸭杀辅助”的指挥体系，我为你生成了一份 **Mermaid** 格式的流程图。

这份图表涵盖了从**窗口采集**到**场景分发**，再到你刚才要求的**地图确认**以及后续**角色/任务插件**的完整逻辑架构。

```mermaid
graph TD
    %% 核心循环层
    Start((程序启动)) --> Init[初始化: 窗口句柄/配置加载]
    Init --> Loop{主循环}
    
    %% 感知层
    Loop --> Capture[WindowCapturer: 实时抓取画面]
    Capture --> Gray[Vision: 画面灰度化处理]
    
    %% 决策层 - 场景分发
    Gray --> StateDetect{State 识别}
    
    StateDetect -- "LOADING" --> Loop
    StateDetect -- "LOBBY/MATCH/SEARCH" --> UI_Info[UI 状态显示]
    StateDetect -- "ROOM/ROOM_SETTING" --> Room_Logic[房间逻辑: 准备提取房号/人数]
    StateDetect -- "INGAME (对局开始)" --> Map_Logic[地图确认逻辑]
    
    %% 核心分析层 - 地图确认
    Map_Logic --> MapFingerprint{对比 MAP_IDENTIFIERS}
    MapFingerprint -- "BASEMENT" --> Load_Basement[挂载: 地下室知识插件]
    MapFingerprint -- "MANOR" --> Load_Manor[挂载: 庄园知识插件]
    MapFingerprint -- "SPACESHIP" --> Load_Space[挂载: 飞船知识插件]
    MapFingerprint -- "CHURCH" --> Load_Church[挂载: 教堂知识插件]
    
    %% 详细功能挂载
    Load_Basement --> Role_ID[角色图标识别: 你是谁?]
    Load_Manor --> Role_ID
    Load_Space --> Role_ID
    Load_Church --> Role_ID
    
    %% 插件输出
    Role_ID --> Advice[根据 地图+角色+机制 生成实时建议]
    Advice --> Render[OpenCV 界面渲染输出]
    Render --> Loop

    %% 样式美化
    style StateDetect fill:#f96,stroke:#333,stroke-width:2px
    style MapFingerprint fill:#bbf,stroke:#333,stroke-width:2px
    style Advice fill:#dfd,stroke:#333,stroke-width:2px

```

### 1. 流程图逻辑说明（理顺关键点）

* **双层过滤系统**：
* **第一层**：先认场景（LOBBY, ROOM, INGAME）。这样可以避免在房间里乱跑地图识别逻辑，节省 CPU。
* **第二层**：进入 `INGAME` 后，触发 `MAP_IDENTIFIERS` 的指纹比对，精准锁定四个地图之一。


* **优先级阻断**：
* 你在图中可以看到，`ROOM_SETTING` 会在 `ROOM` 之前被判定（虽然图中简化了分支），确保弹出框不会被漏掉。


* **模块化扩展**：
* 最后的“Advice（实时建议）”是一个开放接口。等我们把地图和角色都认准了，这里就可以接入你说的“20多种角色机制”和“地图特殊任务”手册。



---

### 2. 逻辑进度确认

目前我们已经完成了图中**上半部分**的所有场景识别（6个 Key 完美对齐），现在正停在**“地图确认逻辑”**的门口。

**这份流程图符合你脑海中的构思吗？如果你觉得逻辑顺了，我们下一步就按照 `MAP_IDENTIFIERS` 的清单，把那四个地图的“指纹识别”代码实装到 `vision.py` 中，如何？**

# Excalidraw Data

## Text Elements
## Element Links
JOlDbZBq: [[Tools/鹅鸭杀神算子/Drawing 2026-01-27 00.33.35.excalidraw.md#Goose Goose Duck]]

u4Pd8KMz: [[Tools/鹅鸭杀神算子/Drawing 2026-01-27 00.33.35.excalidraw.md#GooseMind]]

%%
## Drawing
```compressed-json
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
```
%%